
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>3-Day Scientific Workout Plan – Week 2</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#f9f9f9">
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f9f9f9; }
    h2 { margin-top: 40px; }
    .exercise { margin-bottom: 20px; padding: 10px; background: #fff; border-radius: 8px; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
    label { display: inline-block; margin-right: 10px; }
    .weight-input, .reps-input { margin-left: 10px; width: 60px; }
    .timer { font-weight: bold; margin-left: 10px; }
  </style>
</head>
<body>
  <h1>3-Day Scientific Workout Plan – Week 2</h1>
  <div id="workout"></div>
  <audio id="alarm" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" preload="auto"></audio>
  <button onclick="downloadCSV()">Download Progress CSV</button>

  <script>
    const plan = {
  "Day 1 - Push & Core": [
    { name: "Barbell Bench Press", sets: 4, id: "barbell_bench_press", weight: 135 },
    { name: "Cable Overhead Press", sets: 4, id: "cable_overhead_press", weight: [40, 50] },
    { name: "Dumbbell Chest Fly", sets: 3, id: "dumbbell_chest_fly", weight: 50 },
    { name: "Overhead Cable Crunches", sets: 4, id: "overhead_cable_crunches", weight: 50 },
    { name: "Hanging Knee Raises", sets: 3, id: "hanging_knee_raises", weight: null },
    { name: "Incline Treadmill Walk", sets: 1, id: "incline_treadmill_walk", weight: null },
  ],
  "Day 2 - Pull & Core": [
    { name: "Barbell Deadlift", sets: 4, id: "barbell_deadlift", weight: 185 },
    { name: "Cable Row", sets: 4, id: "cable_row", weight: 100 },
    { name: "Hammer Curls", sets: 4, id: "hammer_curls", weight: 50 },
    { name: "Cable Woodchoppers", sets: 4, id: "cable_woodchoppers", weight: 70 },
    { name: "Plank Hold", sets: 4, id: "plank_hold", weight: null },
    { name: "Bike Sprints", sets: 9, id: "bike_sprints", weight: null },
  ],
  "Day 3 - Legs, Abs & Metcon": [
    { name: "Barbell Back Squat", sets: 4, id: "barbell_back_squat", weight: 160 },
    { name: "Cable Glute Kickbacks", sets: 4, id: "cable_glute_kickbacks", weight: null },
    { name: "Walking Lunges", sets: 3, id: "walking_lunges", weight: null },
    { name: "Weighted Decline Sit-ups", sets: 4, id: "weighted_decline_sit-ups", weight: null },
    { name: "Row Machine or Ski Erg", sets: 1, id: "row_machine_or_ski_erg", weight: null },
  ],
};

    const container = document.getElementById('workout');

    Object.entries(plan).forEach(([day, exercises]) => {
      const dayHeader = document.createElement('h2');
      dayHeader.textContent = day;
      container.appendChild(dayHeader);

      exercises.forEach(ex => {
        const div = document.createElement('div');
        div.className = 'exercise';
        const title = document.createElement('strong');
        title.textContent = ex.name;
        div.appendChild(title);

        if (ex.weight !== null) {
          const input = document.createElement('input');
          input.type = 'text';
          input.className = 'weight-input';
          input.placeholder = 'Weight';
          input.value = loadState(`weight_${ex.id}`) || (Array.isArray(ex.weight) ? ex.weight.join(', ') : ex.weight);
          input.addEventListener('change', () => saveState(`weight_${ex.id}`, input.value));
          div.appendChild(input);
        }

        for (let i = 0; i < ex.sets; i++) {
          const setId = `${ex.id}_set${i}`;
          const label = document.createElement('label');
          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.checked = loadState(`check_${setId}`) === 'true';
          checkbox.addEventListener('change', () => {
            saveState(`check_${setId}`, checkbox.checked);
            if (checkbox.checked) startTimer(label);
          });
          label.appendChild(checkbox);
          label.append(` Set ${i + 1}`);

          const reps = document.createElement('input');
          reps.type = 'text';
          reps.className = 'reps-input';
          reps.placeholder = 'Reps';
          reps.value = loadState(`reps_${setId}`) || "";
          reps.addEventListener('change', () => saveState(`reps_${setId}`, reps.value));
          label.appendChild(reps);

          div.appendChild(label);
        }

        container.appendChild(div);
      });
    });

    function startTimer(label) {
      let seconds = 90;
      const span = document.createElement('span');
      span.className = 'timer';
      label.appendChild(span);
      const interval = setInterval(() => {
        const m = Math.floor(seconds / 60);
        const s = seconds % 60;
        span.textContent = ` (${m}:${s.toString().padStart(2, '0')})`;
        seconds--;
        if (seconds < 0) {
          clearInterval(interval);
          document.getElementById('alarm').play();
          span.textContent = ' ✅ Done';
        }
      }, 1000);
    }

    function downloadCSV() {
      const rows = [["Day", "Exercise", "Set", "Completed", "Weight", "Reps"]];
      document.querySelectorAll(".exercise").forEach(exDiv => {
        const day = exDiv.closest("div").previousElementSibling?.textContent || "";
        const title = exDiv.querySelector("strong")?.textContent || "";
        const weight = exDiv.querySelector("input.weight-input")?.value || "";
        const labels = exDiv.querySelectorAll("label");
        labels.forEach((label, idx) => {
          const checkbox = label.querySelector("input[type='checkbox']");
          const checked = checkbox?.checked ? "Yes" : "No";
          const reps = label.querySelector("input.reps-input")?.value || "";
          rows.push([day, title, `Set ${idx + 1}`, checked, weight, reps]);
        });
      });
      let csvContent = "data:text/csv;charset=utf-8," + rows.map(e => e.join(",")).join("\n");
      const encodedUri = encodeURI(csvContent);
      const link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", "workout_progress.csv");
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    function saveState(key, value) {
      localStorage.setItem(key, value);
    }

    function loadState(key) {
      return localStorage.getItem(key);
    }

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js');
    }
  </script>
</body>
</html>
