
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>3-Day Scientific Workout Plan – Week 5</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#f9f9f9">
  <style>
    body { font-family: Arial, sans-serif; margin: 10px; background: #f9f9f9; }
    h1, h2 { text-align: center; }
    .exercise { margin-bottom: 20px; padding: 10px; background: #fff; border-radius: 8px; box-shadow: 0 0 5px rgba(0,0,0,0.1); }
    label { display: block; margin-bottom: 5px; }
    .weight-input, .reps-input { margin-left: 10px; width: 60px; }
    .timer { font-weight: bold; margin-left: 10px; }
    select { font-size: 1em; padding: 8px; width: 100%; margin-bottom: 20px; }
    .completed-day { background: #c8e6c9; }
    .day-option-completed::after { content: ' ✅'; }
    .button-bar { text-align: center; margin: 15px 0; }
  </style>
</head>
<body>
  <h1>3-Day Scientific Workout Plan – Week 5</h1>
  <select id="day-selector"></select>
  <div class="button-bar">
    <button onclick="downloadCSV()">Download Progress CSV</button>
    <button onclick="resetProgress()">Reset Progress</button>
  </div>
  <div id="workout"></div>
  <audio id="alarm" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" preload="auto"></audio>

  <script>
    const plan = {
  "Day 1 - Push & Core": [
    { name: "Barbell Bench Press", sets: 4, id: "barbell_bench_press", weight: 135 },
    { name: "Cable Overhead Press", sets: 3, id: "cable_overhead_press", weight: [60, 50, 40] },
    { name: "Cable Chest Fly", sets: 3, id: "cable_chest_fly", weight: [30, 30, 25] },
    { name: "Overhead Cable Crunches", sets: 3, id: "overhead_cable_crunches", weight: null },
    { name: "Hanging/Bench Knee Raises", sets: 3, id: "hanging/bench_knee_raises", weight: null },
    { name: "Incline Treadmill Walk", sets: 2, id: "incline_treadmill_walk", weight: null },
  ],
  "Day 2 - Pull & Core": [
    { name: "Barbell Deadlift", sets: 4, id: "barbell_deadlift", weight: 184 },
    { name: "Cable Row", sets: 3, id: "cable_row", weight: null },
    { name: "Cable Hammer Curls", sets: 3, id: "cable_hammer_curls", weight: 52 },
    { name: "Cable Woodchoppers", sets: 3, id: "cable_woodchoppers", weight: null },
    { name: "Plank Hold", sets: 3, id: "plank_hold", weight: null },
    { name: "Bike Sprints", sets: 3, id: "bike_sprints", weight: null },
  ],
  "Day 3 - Legs, Abs & Metcon": [
    { name: "Barbell Back Squat", sets: 4, id: "barbell_back_squat", weight: 165 },
    { name: "Cable Glute Kickbacks", sets: 3, id: "cable_glute_kickbacks", weight: null },
    { name: "Walking Lunges", sets: 3, id: "walking_lunges", weight: null },
    { name: "Weighted Decline Sit-ups", sets: 3, id: "weighted_decline_sit-ups", weight: null },
    { name: "Row Machine or Ski Erg", sets: 2, id: "row_machine_or_ski_erg", weight: null },
  ],
};

    const daySelector = document.getElementById("day-selector");
    const container = document.getElementById("workout");

    Object.keys(plan).forEach(day => {
      const opt = document.createElement("option");
      opt.value = day;
      opt.textContent = day;
      daySelector.appendChild(opt);
    });

    daySelector.addEventListener("change", () => {
      renderDay(daySelector.value);
    });

    function renderDay(day) {
      container.innerHTML = "";
      const exercises = plan[day];
      const dayHeader = document.createElement('h2');
      dayHeader.textContent = day;
      container.appendChild(dayHeader);

      exercises.forEach(ex => {
        const div = document.createElement('div');
        div.className = 'exercise';
        const title = document.createElement('strong');
        title.textContent = ex.name;
        div.appendChild(title);

        if (ex.weight !== null) {
          const input = document.createElement('input');
          input.type = 'text';
          input.className = 'weight-input';
          input.placeholder = 'Weight';
          input.value = loadState(`weight_${ex.id}`) || (Array.isArray(ex.weight) ? ex.weight.join(', ') : ex.weight);
          input.addEventListener('change', () => saveState(`weight_${ex.id}`, input.value));
          div.appendChild(input);
        }

        for (let i = 0; i < ex.sets; i++) {
          const setId = `${ex.id}_set${i}_${day.replaceAll(' ', '_')}`;
          const label = document.createElement('label');
          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.checked = loadState(`check_${setId}`) === 'true';
          checkbox.addEventListener('change', () => {
            saveState(`check_${setId}`, checkbox.checked);
            if (checkbox.checked) startTimer(label);
            checkDayCompletion(day);
          });
          label.appendChild(checkbox);
          label.append(` Set ${i + 1}`);

          const reps = document.createElement('input');
          reps.type = 'text';
          reps.className = 'reps-input';
          reps.placeholder = 'Reps';
          reps.value = loadState(`reps_${setId}`) || "";
          reps.addEventListener('change', () => saveState(`reps_${setId}`, reps.value));
          label.appendChild(reps);

          div.appendChild(label);
        }
        container.appendChild(div);
      });
    }

    function checkDayCompletion(day) {
      const exercises = plan[day];
      let totalSets = 0, completed = 0;
      exercises.forEach(ex => {
        for (let i = 0; i < ex.sets; i++) {
          totalSets++;
          const setId = `${ex.id}_set${i}_${day.replaceAll(' ', '_')}`;
          if (loadState(`check_${setId}`) === 'true') {
            completed++;
          }
        }
      });
      const isComplete = totalSets > 0 && completed === totalSets;
      saveState(`done_${day.replaceAll(' ', '_')}`, isComplete);
      updateDaySelector();
      if (isComplete) {
        const nextIndex = [...daySelector.options].findIndex(opt => opt.value === day) + 1;
        const next = daySelector.options[nextIndex];
        if (next) {
          daySelector.value = next.value;
          renderDay(next.value);
        }
      }
    }

    function updateDaySelector() {
      [...daySelector.options].forEach(opt => {
        const dayKey = opt.value.replaceAll(' ', '_');
        const complete = loadState(`done_${dayKey}`) === 'true';
        opt.className = complete ? 'day-option-completed' : '';
      });
    }

    function startTimer(label) {
      let seconds = 90;
      const span = document.createElement('span');
      span.className = 'timer';
      label.appendChild(span);
      const interval = setInterval(() => {
        const m = Math.floor(seconds / 60);
        const s = seconds % 60;
        span.textContent = ` (${m}:${s.toString().padStart(2, '0')})`;
        seconds--;
        if (seconds < 0) {
          clearInterval(interval);
          document.getElementById('alarm').play();
          span.textContent = ' ✅ Done';
        }
      }, 1000);
    }

    function downloadCSV() {
      const rows = [["Day", "Exercise", "Set", "Completed", "Weight", "Reps"]];
      document.querySelectorAll(".exercise").forEach(exDiv => {
        const day = daySelector.value;
        const title = exDiv.querySelector("strong")?.textContent || "";
        const weight = exDiv.querySelector("input.weight-input")?.value || "";
        const labels = exDiv.querySelectorAll("label");
        labels.forEach((label, idx) => {
          const checkbox = label.querySelector("input[type='checkbox']");
          const checked = checkbox?.checked ? "Yes" : "No";
          const reps = label.querySelector("input.reps-input")?.value || "";
          rows.push([day, title, `Set ${idx + 1}`, checked, weight, reps]);
        });
      });
      let csvContent = "data:text/csv;charset=utf-8," + rows.map(e => e.join(",")).join("\n");
      const encodedUri = encodeURI(csvContent);
      const link = document.createElement("a");
      link.setAttribute("href", encodedUri);
      link.setAttribute("download", "workout_progress.csv");
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    function resetProgress() {
      if (!confirm("Clear all saved progress for this week?")) return;
      localStorage.clear();
      location.reload();
    }

    function saveState(key, value) {
      localStorage.setItem(key, value);
    }

    function loadState(key) {
      return localStorage.getItem(key);
    }

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js');
    }

    renderDay(daySelector.value || daySelector.options[0].value);
    updateDaySelector();
  </script>
</body>
</html>
